// mainvar currentFolderLevel="";clearConsole();// on MAC open File system dialog and select a folder for processing if (isOSX()) {        // House Keeping for wrunning the script on OSX        // Get Relative Folder location. This ensures that the script can run anywhere, in particular when shared on Creative Cloud.                // Ask user to select the processing file        var relativePath = Folder.selectDialog ('Select a Processing Folder', function (f) { return (f instanceof Folder) } );       // var relativePath = getRelativePath();                $.writeln ( "Based from Relative Path = " + relativePath);                    }readFolderAndContents(relativePath); // Clear Consiole when run from Adobe Extend Scriptfunction clearConsole() {    // Clear console    var bt = new BridgeTalk();    bt.target = 'estoolkit-4.0';    bt.body = function(){    app.clc();    }.toSource()+"()";    bt.send(5);}function isOSX(){    return $.os.match(/Macintosh/i);}// read file systemfunction readFolderAndContents(folderName) {        var aChildren = Folder(folderName).getFiles();                 // read files and folders,         for (var i = 0; i < aChildren.length; i++) {             var child = aChildren[i];             if (child instanceof Folder ) {                 $.writeln("folder name="+child.name);                  currentFolderLevel++;                   // store current folder name, as will need this to find the layer (folder name as a prefix)                    currentLayerSet = child.name;                    // read next folder in the set                    readFolderAndContents(folderName+"/"+child.name);                    // Once the folder has been read, then reduce the folder level by one.                    currentFolderLevel--;                                     } else {                     $.writeln("cxx="+child.name.split(".")[1].toUpperCase());                   if (child.name.split(".")[1].toUpperCase()=="JPG" || child.name.split(".")[1].toUpperCase()=="JPEG"|| child.name.split(".")[1].toUpperCase()=="PSD") {                     if (child.name!=".DS_Store"){                        openFile(folderName,child.name);                        $.writeln(child.name);                        var fileNameSplit=child.name.split('_');                        $.writeln("file width="+app.activeDocument.width);                        $.writeln("fileNameSplit="+fileNameSplit);                        $.writeln("fileNameSplit="+fileNameSplit.length);                            if (fileNameSplit.length>2) {                                $.writeln("=======>");                                var fileNameWidth = fileNameSplit[2].substr(1,fileNameSplit[2].length);                                // only change the width if the width specified is not the same as the image width                                if (app.activeDocument.width!=fileNameWidth) {                                    $.writeln("file name width="+fileNameWidth.split(".")[0]);                                    // re-size the image with the new width (noted by Wxxx (where xxx is the new width in the file name)                                    resizeImagePX(fileNameWidth.split(".")[0]);                                    $.writeln("===saving file");                                    saveFile(folderName+"/"+child.name);                                }                            }                        closeFile();                     }                 }               }                                 }                    } function saveFile(fileName) {    // =======================================================var idsave = charIDToTypeID( "save" );    var desc37 = new ActionDescriptor();    var idIn = charIDToTypeID( "In  " );//    desc37.putPath( idIn, new File( "/Users/richardcurtis_Production/OneDrive/OneDrive - Adobe Systems Inc/One Drive Documents/Customers/RiverIsland/imageResizer/Inbound/AdobeStock_113534069_W300.jpg" ) );    desc37.putPath( idIn, new File( fileName) );    var idDocI = charIDToTypeID( "DocI" );    desc37.putInteger( idDocI, 331 );    var idsaveStage = stringIDToTypeID( "saveStage" );    var idsaveStageType = stringIDToTypeID( "saveStageType" );    var idsaveSucceeded = stringIDToTypeID( "saveSucceeded" );    desc37.putEnumerated( idsaveStage, idsaveStageType, idsaveSucceeded );executeAction( idsave, desc37, DialogModes.NO );} function  saveFileToOutputFolder(relativePath,outputFolder,fileName) {     // =======================================================    var outputName = relativePath + "/"+outputFolder+"/"+fileName;         var idsave = charIDToTypeID( "save" );    var desc378 = new ActionDescriptor();    var idAs = charIDToTypeID( "As  " );        var desc379 = new ActionDescriptor();        var idEQlt = charIDToTypeID( "EQlt" );        desc379.putInteger( idEQlt, 6 );        var idOptm = charIDToTypeID( "Optm" );        desc379.putBoolean( idOptm, true );        var idMttC = charIDToTypeID( "MttC" );        var idMttC = charIDToTypeID( "MttC" );        var idNone = charIDToTypeID( "None" );        desc379.putEnumerated( idMttC, idMttC, idNone );    var idJPEG = charIDToTypeID( "JPEG" );    desc378.putObject( idAs, idJPEG, desc379 );    var idIn = charIDToTypeID( "In  " );    //desc378.putPath( idIn, new File( "/Users/richardcurtis_Production/Desktop/imageResizer/Output/AdobeStock_113534069.jpg" ) );    desc378.putPath( idIn, new File( outputName ) );    var idDocI = charIDToTypeID( "DocI" );    desc378.putInteger( idDocI, 3553 );    var idLwCs = charIDToTypeID( "LwCs" );    desc378.putBoolean( idLwCs, true );    var idsaveStage = stringIDToTypeID( "saveStage" );    var idsaveStageType = stringIDToTypeID( "saveStageType" );    var idsaveSucceeded = stringIDToTypeID( "saveSucceeded" );    desc378.putEnumerated( idsaveStage, idsaveStageType, idsaveSucceeded );    executeAction( idsave, desc378, DialogModes.NO );     }  function resizeImage(percentage) {     // =======================================================    var idImgS = charIDToTypeID( "ImgS" );    var desc370 = new ActionDescriptor();    var idWdth = charIDToTypeID( "Wdth" );    var idPrc = charIDToTypeID( "#Prc" );//    desc370.putUnitDouble( idWdth, idPrc, 50.000000 );    desc370.putUnitDouble( idWdth, idPrc, percentage );    var idscaleStyles = stringIDToTypeID( "scaleStyles" );    desc370.putBoolean( idscaleStyles, true );    var idCnsP = charIDToTypeID( "CnsP" );    desc370.putBoolean( idCnsP, true );    var idIntr = charIDToTypeID( "Intr" );    var idIntp = charIDToTypeID( "Intp" );    var iddeepUpscale = stringIDToTypeID( "deepUpscale" );    desc370.putEnumerated( idIntr, idIntp, iddeepUpscale );    var idNose = charIDToTypeID( "Nose" );    desc370.putInteger( idNose, 0 );    executeAction( idImgS, desc370, DialogModes.NO );     } function resizeImagePX(width) {          var idImgS = charIDToTypeID( "ImgS" );    var desc21 = new ActionDescriptor();    var idWdth = charIDToTypeID( "Wdth" );    var idPxl = charIDToTypeID( "#Pxl" );    //    desc21.putUnitDouble( idWdth, idPxl, 300.000000 );    desc21.putUnitDouble( idWdth, idPxl, width );    var idscaleStyles = stringIDToTypeID( "scaleStyles" );    desc21.putBoolean( idscaleStyles, true );    var idCnsP = charIDToTypeID( "CnsP" );    desc21.putBoolean( idCnsP, true );    var idIntr = charIDToTypeID( "Intr" );    var idIntp = charIDToTypeID( "Intp" );    var idautomaticInterpolation = stringIDToTypeID( "automaticInterpolation" );    desc21.putEnumerated( idIntr, idIntp, idautomaticInterpolation );    executeAction( idImgS, desc21, DialogModes.NO );}       function closeFile() {     // =======================================================    var idCls = charIDToTypeID( "Cls " );    var desc363 = new ActionDescriptor();    var idDocI = charIDToTypeID( "DocI" );    desc363.putInteger( idDocI, 3549 );    var idforceNotify = stringIDToTypeID( "forceNotify" );    desc363.putBoolean( idforceNotify, true );    executeAction( idCls, desc363, DialogModes.NO );     } //main     function openFile(relativePath, filename) {    // =======================================================    // From Photoshop    var idOpn = charIDToTypeID( "Opn " );    var desc361 = new ActionDescriptor();    var iddontRecord = stringIDToTypeID( "dontRecord" );    desc361.putBoolean( iddontRecord, false );    var idforceNotify = stringIDToTypeID( "forceNotify" );    desc361.putBoolean( idforceNotify, true );    var idnull = charIDToTypeID( "null" );    //    desc361.putPath( idnull, new File( "/Users/richardcurtis_Production/Desktop/imageResizer/AdobeStock_113534069.jpg" ) );    desc361.putPath( idnull, new File( relativePath+"/"+filename ) );    var idDocI = charIDToTypeID( "DocI" );    desc361.putInteger( idDocI, 3549 );    executeAction( idOpn, desc361, DialogModes.NO );    }